<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fill in the Gap Game</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #001510, #002022);
            background-size: 400% 400%;
            color: white;
            overflow: hidden;
            animation: Gradient 15s ease infinite;
        }

        @keyframes Gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .container {
            text-align: center;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            width: 90%;
            max-width: 600px;
            overflow-y: auto;
            max-height: 90vh;
        }

        h1 {
            font-size: 36px;
            color: #00ff00;
            text-shadow: 2px 2px 5px #000000;
        }

        p {
            font-size: 24px;
            margin: 10px 0;
            font-weight: bold;
            color: #ccc;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        .option {
            margin: 10px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: 1px solid #00ff00;
            border-radius: 5px;
            font-size: 18px;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        .option:hover {
            background-color: #555;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        button {
            margin-top: 20px;
            padding: 10px 25px;
            cursor: pointer;
            background-color: #444;
            color: white;
            border: 1px solid #00ff00;
            border-radius: 5px;
            font-weight: bold;
            font-size: 20px;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        button:hover {
            background-color: #666;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .score {
            margin-top: 20px;
            font-weight: bold;
            font-size: 24px;
            color: #ccc;
        }

        #highScore {
            margin-top: 20px;
            font-size: 25px;
            font-weight: bold;
            color: #00ff00;
        }

        #result {
            margin-top: 20px;
            font-size: 24px;
        }

        .incorrect {
            color: red;
        }

        .correct {
            color: green;
        }

        .gap {
            display: inline-block;
            width: 150px;
            border-bottom: 2px solid #00ff00;
            margin: 0 5px;
            padding: 0 5px;
            cursor: pointer;
            min-height: 24px;
        }

        @media only screen and (max-width: 600px) {
            h1 {
                font-size: 28px;
            }

            p {
                font-size: 20px;
            }

            .option {
                font-size: 16px;
                padding: 8px 12px;
            }

            button {
                font-size: 18px;
                padding: 8px 20px;
            }

            .score {
                font-size: 20px;
            }

            #highScore {
                font-size: 20px;
            }

            #result {
                font-size: 20px;
            }

            .gap {
                width: 100px;
                font-size: 18px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Fill in the Gap Game</h1>
        <textarea id="inputPassage" rows="5" cols="40" placeholder="Enter your passage here..."></textarea>
        <button onclick="generateGame()">Generate Game</button>
        <div id="gameContent" style="display: none;">
            <p id="questionPassage"></p>
            <div class="options" id="options"></div>
            <p id="result"></p>
            <button onclick="checkAnswers()">Check Answers</button>
            <button onclick="resetGame()">Reset Game</button>
            <p class="score">Score: <span id="currentScore">0</span></p>
            <p id="highScore">High Score: <span id="highScoreValue">0</span></p>
        </div>
    </div>

    <script>
        let answers = {};
        let options = [];
        let score = 0;
        let highScore = 0;

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            const targetElement = event.target;

            // Return any existing word to the options pool
            if (targetElement.innerText !== '') {
                returnOption(targetElement.innerText);
            }

            // Move the word to the gap
            targetElement.innerText = draggedElement.innerText;
            draggedElement.style.visibility = 'hidden';
        }

        function touchStart(event) {
            event.target.style.borderColor = 'yellow';
        }

        function touchEnd(event) {
            event.target.style.borderColor = '#00ff00';
        }

        function returnOption(optionText) {
            const optionElement = Array.from(document.getElementsByClassName('option')).find(opt => opt.innerText === optionText);
            if (optionElement) {
                optionElement.style.visibility = 'visible';
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function generateOptions() {
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            shuffleArray(options);

            options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.id = 'option' + index;
                optionElement.draggable = true;
                optionElement.ondragstart = drag;
                optionElement.ontouchstart = function (event) {
                    event.dataTransfer = {
                        setData: function (key, value) {
                            this[key] = value;
                        },
                        getData: function (key) {
                            return this[key];
                        }
                    };
                    drag(event);
                };
                optionElement.innerText = option;
                optionsContainer.appendChild(optionElement);
            });
        }

        function checkAnswers() {
            let correct = true;
            score = 0;

            for (const gap in answers) {
                const userAnswer = document.getElementById(gap).innerText.trim();
                if (userAnswer === answers[gap]) {
                    document.getElementById(gap).classList.add('correct');
                    document.getElementById(gap).classList.remove('incorrect');
                    score++;
                } else {
                    document.getElementById(gap).classList.add('incorrect');
                    document.getElementById(gap).classList.remove('correct');
                    correct = false;
                }
            }

            document.getElementById('currentScore').innerText = score;
            document.getElementById('result').innerText = correct ? 'All answers are correct!' : 'Some answers are incorrect.';

            updateHighScore();
        }

        function resetGame() {
            document.getElementById('inputPassage').value = '';
            document.getElementById('questionPassage').innerText = '';
            document.getElementById('result').innerText = '';
            document.getElementById('currentScore').innerText = '0';
            document.getElementById('gameContent').style.display = 'none';
            document.getElementById('inputPassage').style.display = 'block';
        }

        function updateHighScore() {
            if (score > highScore) {
                highScore = score;
                document.getElementById('highScoreValue').innerText = highScore;
            }
        }

        function generateGame() {
            const passage = document.getElementById('inputPassage').value;
            const words = passage.split(' ');
            const numberOfBlanks = Math.floor(words.length / 5);

            answers = {};
            options = [];

            for (let i = 0; i < numberOfBlanks; i++) {
                const randomIndex = Math.floor(Math.random() * words.length);
                const word = words[randomIndex].replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, "");
                answers[`gap${i}`] = word;
                options.push(word);
                words[randomIndex] = `<span class="gap" id="gap${i}" ondrop="drop(event)" ondragover="allowDrop(event)" ontouchstart="touchStart(event)" ontouchend="touchEnd(event)"></span>`;
            }

            document.getElementById('questionPassage').innerHTML = words.join(' ');
            generateOptions();
            document.getElementById('inputPassage').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
        }

        generateOptions();
    </script>
</body>

</html>
